<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : MyBB 1.6.8 : /inc/functions_posting.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of MyBB 1.6.8</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Mon Jun  4 13:54:24 2012 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='inc';
filename='functions_posting.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/inc/</a> -> <a href="functions_posting.php.html">functions_posting.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="functions_posting.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="functions_posting.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * MyBB 1.6</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> * Copyright 2010 MyBB Group, All Rights Reserved</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> *</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * Website: http://mybb.com</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * License: http://mybb.com/about/license</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> *</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * $Id: functions_posting.php 5623 2011-10-01 02:46:09Z ralgith $</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> */</span>
<a name="l11"><span class="linenum">  11</span></a>  
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">/**</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * Selectively removes quote tags from a message, depending on its nested depth.  This is to be used with reply with quote functions.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> * For malformed quote tag structures, will try to simulate how MyBB's parser handles the issue, but is slightly inaccurate.</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> * Examples, with a cutoff depth of 2:</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment"> *  #1. INPUT:  [quote]a[quote=me]b[quote]c[/quote][/quote][/quote]</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> *     OUTPUT:  [quote]a[quote=me]b[/quote][/quote]</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> *  #2. INPUT:  [quote=a][quote=b][quote=c][quote=d][/quote][quote=e][/quote][/quote][quote=f][/quote][/quote]</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *     OUTPUT:  [quote=a][quote=b][/quote][quote=f][/quote][/quote]</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * </span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @param string the message from which quotes are to be removed</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @param integer nested depth at which quotes should be removed; if none supplied, will use MyBB's default; must be at least 0</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @return string the original message passed in $text, but with quote tags selectively removed</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  function <a class="function" onClick="logFunction('remove_message_quotes')" href="../_functions/remove_message_quotes.html" onMouseOver="funcPopup(event,'remove_message_quotes')">remove_message_quotes</a>(&amp;<a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it4768" onMouseOver="hilite(4768)" onMouseOut="lolite()" onClick="logVariable('rmdepth')" href="../_variables/rmdepth.html">$rmdepth</a>=null)
<a name="l26"><span class="linenum">  26</span></a>  {
<a name="l27"><span class="linenum">  27</span></a>      if(!<a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>)
<a name="l28"><span class="linenum">  28</span></a>      {
<a name="l29"><span class="linenum">  29</span></a>          return <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>;
<a name="l30"><span class="linenum">  30</span></a>      }
<a name="l31"><span class="linenum">  31</span></a>      if(!isset(<a class="var it4768" onMouseOver="hilite(4768)" onMouseOut="lolite()" onClick="logVariable('rmdepth')" href="../_variables/rmdepth.html">$rmdepth</a>))
<a name="l32"><span class="linenum">  32</span></a>      {
<a name="l33"><span class="linenum">  33</span></a>          global <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('mybb')" href="../_variables/mybb.html">$mybb</a>;
<a name="l34"><span class="linenum">  34</span></a>          <a class="var it4768" onMouseOver="hilite(4768)" onMouseOut="lolite()" onClick="logVariable('rmdepth')" href="../_variables/rmdepth.html">$rmdepth</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('mybb')" href="../_variables/mybb.html">$mybb</a>-&gt;<a onClick="logVariable('settings')" class="var it8056" onMouseOver="hilite(8056)" onMouseOut="lolite()" href="../_variables/settings.html">settings</a>['maxquotedepth'];
<a name="l35"><span class="linenum">  35</span></a>      }
<a name="l36"><span class="linenum">  36</span></a>      <a class="var it4768" onMouseOver="hilite(4768)" onMouseOut="lolite()" onClick="logVariable('rmdepth')" href="../_variables/rmdepth.html">$rmdepth</a> = <a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it4768" onMouseOver="hilite(4768)" onMouseOut="lolite()" onClick="logVariable('rmdepth')" href="../_variables/rmdepth.html">$rmdepth</a>);
<a name="l37"><span class="linenum">  37</span></a>      
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">    // find all tokens</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">    // note, at various places, we use the prefix &quot;s&quot; to denote &quot;start&quot; (ie [quote]) and &quot;e&quot; to denote &quot;end&quot; (ie [/quote])</span>
<a name="l40"><span class="linenum">  40</span></a>      <a class="phpfunction" onClick="logFunction('preg_match_all')" href="../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>(&quot;#\[quote(=(?:&amp;quot;|\&quot;|')?.*?(?:&amp;quot;|\&quot;|')?)?\]#si&quot;, <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it4769" onMouseOver="hilite(4769)" onMouseOut="lolite()" onClick="logVariable('smatches')" href="../_variables/smatches.html">$smatches</a>, PREG_OFFSET_CAPTURE | PREG_PATTERN_ORDER);
<a name="l41"><span class="linenum">  41</span></a>      <a class="phpfunction" onClick="logFunction('preg_match_all')" href="../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>(&quot;#\[/quote\]#i&quot;, <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it4770" onMouseOver="hilite(4770)" onMouseOut="lolite()" onClick="logVariable('ematches')" href="../_variables/ematches.html">$ematches</a>, PREG_OFFSET_CAPTURE | PREG_PATTERN_ORDER);
<a name="l42"><span class="linenum">  42</span></a>      
<a name="l43"><span class="linenum">  43</span></a>      if(<a class="function" onClick="logFunction('empty')" href="../_functions/empty.html" onMouseOver="funcPopup(event,'empty')">empty</a>(<a class="var it4769" onMouseOver="hilite(4769)" onMouseOut="lolite()" onClick="logVariable('smatches')" href="../_variables/smatches.html">$smatches</a>) || <a class="function" onClick="logFunction('empty')" href="../_functions/empty.html" onMouseOver="funcPopup(event,'empty')">empty</a>(<a class="var it4770" onMouseOver="hilite(4770)" onMouseOut="lolite()" onClick="logVariable('ematches')" href="../_variables/ematches.html">$ematches</a>))
<a name="l44"><span class="linenum">  44</span></a>      {
<a name="l45"><span class="linenum">  45</span></a>          return <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>;
<a name="l46"><span class="linenum">  46</span></a>      }
<a name="l47"><span class="linenum">  47</span></a>      
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">    // make things easier by only keeping offsets</span>
<a name="l49"><span class="linenum">  49</span></a>      <a class="var it4771" onMouseOver="hilite(4771)" onMouseOut="lolite()" onClick="logVariable('soffsets')" href="../_variables/soffsets.html">$soffsets</a> = <a class="var it4772" onMouseOver="hilite(4772)" onMouseOut="lolite()" onClick="logVariable('eoffsets')" href="../_variables/eoffsets.html">$eoffsets</a> = array();
<a name="l50"><span class="linenum">  50</span></a>      foreach(<a class="var it4769" onMouseOver="hilite(4769)" onMouseOut="lolite()" onClick="logVariable('smatches')" href="../_variables/smatches.html">$smatches</a>[0] as <a class="var it411" onMouseOver="hilite(411)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a> =&gt; <a class="var it2324" onMouseOver="hilite(2324)" onMouseOut="lolite()" onClick="logVariable('match')" href="../_variables/match.html">$match</a>)
<a name="l51"><span class="linenum">  51</span></a>      {
<a name="l52"><span class="linenum">  52</span></a>          <a class="var it4771" onMouseOver="hilite(4771)" onMouseOut="lolite()" onClick="logVariable('soffsets')" href="../_variables/soffsets.html">$soffsets</a>[] = <a class="var it2324" onMouseOver="hilite(2324)" onMouseOut="lolite()" onClick="logVariable('match')" href="../_variables/match.html">$match</a>[1];
<a name="l53"><span class="linenum">  53</span></a>      }
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">    // whilst we loop, also remove unnecessary end tokens at the start of string</span>
<a name="l55"><span class="linenum">  55</span></a>      <a class="var it4773" onMouseOver="hilite(4773)" onMouseOut="lolite()" onClick="logVariable('first_token')" href="../_variables/first_token.html">$first_token</a> = <a class="var it4771" onMouseOver="hilite(4771)" onMouseOut="lolite()" onClick="logVariable('soffsets')" href="../_variables/soffsets.html">$soffsets</a>[0];
<a name="l56"><span class="linenum">  56</span></a>      foreach(<a class="var it4770" onMouseOver="hilite(4770)" onMouseOut="lolite()" onClick="logVariable('ematches')" href="../_variables/ematches.html">$ematches</a>[0] as <a class="var it411" onMouseOver="hilite(411)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a> =&gt; <a class="var it2324" onMouseOver="hilite(2324)" onMouseOut="lolite()" onClick="logVariable('match')" href="../_variables/match.html">$match</a>)
<a name="l57"><span class="linenum">  57</span></a>      {
<a name="l58"><span class="linenum">  58</span></a>          if(<a class="var it2324" onMouseOver="hilite(2324)" onMouseOut="lolite()" onClick="logVariable('match')" href="../_variables/match.html">$match</a>[1] &gt; <a class="var it4773" onMouseOver="hilite(4773)" onMouseOut="lolite()" onClick="logVariable('first_token')" href="../_variables/first_token.html">$first_token</a>)
<a name="l59"><span class="linenum">  59</span></a>          {
<a name="l60"><span class="linenum">  60</span></a>              <a class="var it4772" onMouseOver="hilite(4772)" onMouseOut="lolite()" onClick="logVariable('eoffsets')" href="../_variables/eoffsets.html">$eoffsets</a>[] = <a class="var it2324" onMouseOver="hilite(2324)" onMouseOut="lolite()" onClick="logVariable('match')" href="../_variables/match.html">$match</a>[1];
<a name="l61"><span class="linenum">  61</span></a>          }
<a name="l62"><span class="linenum">  62</span></a>      }
<a name="l63"><span class="linenum">  63</span></a>      <a class="function" onClick="logFunction('unset')" href="../_functions/unset.html" onMouseOver="funcPopup(event,'unset')">unset</a>(<a class="var it4769" onMouseOver="hilite(4769)" onMouseOut="lolite()" onClick="logVariable('smatches')" href="../_variables/smatches.html">$smatches</a>, <a class="var it4770" onMouseOver="hilite(4770)" onMouseOut="lolite()" onClick="logVariable('ematches')" href="../_variables/ematches.html">$ematches</a>);
<a name="l64"><span class="linenum">  64</span></a>      
<a name="l65"><span class="linenum">  65</span></a>      
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">    // elmininate malformed quotes by parsing like the parser does (preg_replace in a while loop)</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">    // NOTE: this is slightly inaccurate because the parser considers [quote] and [quote=...] to be different things</span>
<a name="l68"><span class="linenum">  68</span></a>      <a class="var it4774" onMouseOver="hilite(4774)" onMouseOut="lolite()" onClick="logVariable('good_offsets')" href="../_variables/good_offsets.html">$good_offsets</a> = array();
<a name="l69"><span class="linenum">  69</span></a>      while(!<a class="function" onClick="logFunction('empty')" href="../_functions/empty.html" onMouseOver="funcPopup(event,'empty')">empty</a>(<a class="var it4771" onMouseOver="hilite(4771)" onMouseOut="lolite()" onClick="logVariable('soffsets')" href="../_variables/soffsets.html">$soffsets</a>) &amp;&amp; !<a class="function" onClick="logFunction('empty')" href="../_functions/empty.html" onMouseOver="funcPopup(event,'empty')">empty</a>(<a class="var it4772" onMouseOver="hilite(4772)" onMouseOut="lolite()" onClick="logVariable('eoffsets')" href="../_variables/eoffsets.html">$eoffsets</a>)) // don't rely on this condition - an end offset before the start offset will cause this to loop indefinitely
<a name="l70"><span class="linenum">  70</span></a>      {
<a name="l71"><span class="linenum">  71</span></a>          <a class="var it4775" onMouseOver="hilite(4775)" onMouseOut="lolite()" onClick="logVariable('last_offset')" href="../_variables/last_offset.html">$last_offset</a> = 0;
<a name="l72"><span class="linenum">  72</span></a>          foreach(<a class="var it4771" onMouseOver="hilite(4771)" onMouseOut="lolite()" onClick="logVariable('soffsets')" href="../_variables/soffsets.html">$soffsets</a> as <a class="var it4776" onMouseOver="hilite(4776)" onMouseOut="lolite()" onClick="logVariable('sk')" href="../_variables/sk.html">$sk</a> =&gt; &amp;<a class="var it4777" onMouseOver="hilite(4777)" onMouseOut="lolite()" onClick="logVariable('soffset')" href="../_variables/soffset.html">$soffset</a>)
<a name="l73"><span class="linenum">  73</span></a>          {
<a name="l74"><span class="linenum">  74</span></a>              if(<a class="var it4777" onMouseOver="hilite(4777)" onMouseOut="lolite()" onClick="logVariable('soffset')" href="../_variables/soffset.html">$soffset</a> &gt;= <a class="var it4775" onMouseOver="hilite(4775)" onMouseOut="lolite()" onClick="logVariable('last_offset')" href="../_variables/last_offset.html">$last_offset</a>)
<a name="l75"><span class="linenum">  75</span></a>              {
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">                // search for corresponding eoffset</span>
<a name="l77"><span class="linenum">  77</span></a>                  foreach(<a class="var it4772" onMouseOver="hilite(4772)" onMouseOut="lolite()" onClick="logVariable('eoffsets')" href="../_variables/eoffsets.html">$eoffsets</a> as <a class="var it4778" onMouseOver="hilite(4778)" onMouseOut="lolite()" onClick="logVariable('ek')" href="../_variables/ek.html">$ek</a> =&gt; &amp;<a class="var it4779" onMouseOver="hilite(4779)" onMouseOut="lolite()" onClick="logVariable('eoffset')" href="../_variables/eoffset.html">$eoffset</a>) // use foreach instead of for to get around indexing issues with unset
<a name="l78"><span class="linenum">  78</span></a>                  {
<a name="l79"><span class="linenum">  79</span></a>                      if(<a class="var it4779" onMouseOver="hilite(4779)" onMouseOut="lolite()" onClick="logVariable('eoffset')" href="../_variables/eoffset.html">$eoffset</a> &gt; <a class="var it4777" onMouseOver="hilite(4777)" onMouseOut="lolite()" onClick="logVariable('soffset')" href="../_variables/soffset.html">$soffset</a>)
<a name="l80"><span class="linenum">  80</span></a>                      {
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">                        // we've found a pair</span>
<a name="l82"><span class="linenum">  82</span></a>                          <a class="var it4774" onMouseOver="hilite(4774)" onMouseOut="lolite()" onClick="logVariable('good_offsets')" href="../_variables/good_offsets.html">$good_offsets</a>[<a class="var it4777" onMouseOver="hilite(4777)" onMouseOut="lolite()" onClick="logVariable('soffset')" href="../_variables/soffset.html">$soffset</a>] = 1;
<a name="l83"><span class="linenum">  83</span></a>                          <a class="var it4774" onMouseOver="hilite(4774)" onMouseOut="lolite()" onClick="logVariable('good_offsets')" href="../_variables/good_offsets.html">$good_offsets</a>[<a class="var it4779" onMouseOver="hilite(4779)" onMouseOut="lolite()" onClick="logVariable('eoffset')" href="../_variables/eoffset.html">$eoffset</a>] = -1;
<a name="l84"><span class="linenum">  84</span></a>                          <a class="var it4775" onMouseOver="hilite(4775)" onMouseOut="lolite()" onClick="logVariable('last_offset')" href="../_variables/last_offset.html">$last_offset</a> = <a class="var it4779" onMouseOver="hilite(4779)" onMouseOut="lolite()" onClick="logVariable('eoffset')" href="../_variables/eoffset.html">$eoffset</a>;
<a name="l85"><span class="linenum">  85</span></a>                          
<a name="l86"><span class="linenum">  86</span></a>                          <a class="function" onClick="logFunction('unset')" href="../_functions/unset.html" onMouseOver="funcPopup(event,'unset')">unset</a>(<a class="var it4771" onMouseOver="hilite(4771)" onMouseOut="lolite()" onClick="logVariable('soffsets')" href="../_variables/soffsets.html">$soffsets</a>[<a class="var it4776" onMouseOver="hilite(4776)" onMouseOut="lolite()" onClick="logVariable('sk')" href="../_variables/sk.html">$sk</a>], <a class="var it4772" onMouseOver="hilite(4772)" onMouseOut="lolite()" onClick="logVariable('eoffsets')" href="../_variables/eoffsets.html">$eoffsets</a>[<a class="var it4778" onMouseOver="hilite(4778)" onMouseOut="lolite()" onClick="logVariable('ek')" href="../_variables/ek.html">$ek</a>]);
<a name="l87"><span class="linenum">  87</span></a>                          break;
<a name="l88"><span class="linenum">  88</span></a>                      }
<a name="l89"><span class="linenum">  89</span></a>                  }
<a name="l90"><span class="linenum">  90</span></a>              }
<a name="l91"><span class="linenum">  91</span></a>          }
<a name="l92"><span class="linenum">  92</span></a>          
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">        // remove any end offsets occurring before start offsets</span>
<a name="l94"><span class="linenum">  94</span></a>          <a class="var it4780" onMouseOver="hilite(4780)" onMouseOut="lolite()" onClick="logVariable('first_start')" href="../_variables/first_start.html">$first_start</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it4771" onMouseOver="hilite(4771)" onMouseOut="lolite()" onClick="logVariable('soffsets')" href="../_variables/soffsets.html">$soffsets</a>);
<a name="l95"><span class="linenum">  95</span></a>          foreach(<a class="var it4772" onMouseOver="hilite(4772)" onMouseOut="lolite()" onClick="logVariable('eoffsets')" href="../_variables/eoffsets.html">$eoffsets</a> as <a class="var it4778" onMouseOver="hilite(4778)" onMouseOut="lolite()" onClick="logVariable('ek')" href="../_variables/ek.html">$ek</a> =&gt; &amp;<a class="var it4779" onMouseOver="hilite(4779)" onMouseOut="lolite()" onClick="logVariable('eoffset')" href="../_variables/eoffset.html">$eoffset</a>)
<a name="l96"><span class="linenum">  96</span></a>          {
<a name="l97"><span class="linenum">  97</span></a>              if(<a class="var it4779" onMouseOver="hilite(4779)" onMouseOut="lolite()" onClick="logVariable('eoffset')" href="../_variables/eoffset.html">$eoffset</a> &lt; <a class="var it4780" onMouseOver="hilite(4780)" onMouseOut="lolite()" onClick="logVariable('first_start')" href="../_variables/first_start.html">$first_start</a>)
<a name="l98"><span class="linenum">  98</span></a>              {
<a name="l99"><span class="linenum">  99</span></a>                  <a class="function" onClick="logFunction('unset')" href="../_functions/unset.html" onMouseOver="funcPopup(event,'unset')">unset</a>(<a class="var it4772" onMouseOver="hilite(4772)" onMouseOut="lolite()" onClick="logVariable('eoffsets')" href="../_variables/eoffsets.html">$eoffsets</a>[<a class="var it4778" onMouseOver="hilite(4778)" onMouseOut="lolite()" onClick="logVariable('ek')" href="../_variables/ek.html">$ek</a>]);
<a name="l100"><span class="linenum"> 100</span></a>              }
<a name="l101"><span class="linenum"> 101</span></a>              else
<a name="l102"><span class="linenum"> 102</span></a>              {
<a name="l103"><span class="linenum"> 103</span></a>                  break;
<a name="l104"><span class="linenum"> 104</span></a>              }
<a name="l105"><span class="linenum"> 105</span></a>          }
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">        // we don't need to remove start offsets after the last end offset, because the loop will deplete something before that</span>
<a name="l107"><span class="linenum"> 107</span></a>      }
<a name="l108"><span class="linenum"> 108</span></a>      
<a name="l109"><span class="linenum"> 109</span></a>      
<a name="l110"><span class="linenum"> 110</span></a>      if(<a class="function" onClick="logFunction('empty')" href="../_functions/empty.html" onMouseOver="funcPopup(event,'empty')">empty</a>(<a class="var it4774" onMouseOver="hilite(4774)" onMouseOut="lolite()" onClick="logVariable('good_offsets')" href="../_variables/good_offsets.html">$good_offsets</a>))
<a name="l111"><span class="linenum"> 111</span></a>      {
<a name="l112"><span class="linenum"> 112</span></a>          return <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>;
<a name="l113"><span class="linenum"> 113</span></a>      }
<a name="l114"><span class="linenum"> 114</span></a>      <a class="phpfunction" onClick="logFunction('ksort')" href="../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it4774" onMouseOver="hilite(4774)" onMouseOut="lolite()" onClick="logVariable('good_offsets')" href="../_variables/good_offsets.html">$good_offsets</a>);
<a name="l115"><span class="linenum"> 115</span></a>      
<a name="l116"><span class="linenum"> 116</span></a>      
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">    // we now have a list of all the ordered tokens, ready to go through</span>
<a name="l118"><span class="linenum"> 118</span></a>      <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('depth')" href="../_variables/depth.html">$depth</a> = 0;
<a name="l119"><span class="linenum"> 119</span></a>      <a class="var it4781" onMouseOver="hilite(4781)" onMouseOut="lolite()" onClick="logVariable('remove_regions')" href="../_variables/remove_regions.html">$remove_regions</a> = array();
<a name="l120"><span class="linenum"> 120</span></a>      <a class="var it4782" onMouseOver="hilite(4782)" onMouseOut="lolite()" onClick="logVariable('tmp_start')" href="../_variables/tmp_start.html">$tmp_start</a> = 0;
<a name="l121"><span class="linenum"> 121</span></a>      foreach(<a class="var it4774" onMouseOver="hilite(4774)" onMouseOut="lolite()" onClick="logVariable('good_offsets')" href="../_variables/good_offsets.html">$good_offsets</a> as <a class="var it1388" onMouseOver="hilite(1388)" onMouseOut="lolite()" onClick="logVariable('offset')" href="../_variables/offset.html">$offset</a> =&gt; <a class="var it4783" onMouseOver="hilite(4783)" onMouseOut="lolite()" onClick="logVariable('dincr')" href="../_variables/dincr.html">$dincr</a>)
<a name="l122"><span class="linenum"> 122</span></a>      {
<a name="l123"><span class="linenum"> 123</span></a>          if(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('depth')" href="../_variables/depth.html">$depth</a> == <a class="var it4768" onMouseOver="hilite(4768)" onMouseOut="lolite()" onClick="logVariable('rmdepth')" href="../_variables/rmdepth.html">$rmdepth</a> &amp;&amp; <a class="var it4783" onMouseOver="hilite(4783)" onMouseOut="lolite()" onClick="logVariable('dincr')" href="../_variables/dincr.html">$dincr</a> == 1)
<a name="l124"><span class="linenum"> 124</span></a>          {
<a name="l125"><span class="linenum"> 125</span></a>              <a class="var it4782" onMouseOver="hilite(4782)" onMouseOut="lolite()" onClick="logVariable('tmp_start')" href="../_variables/tmp_start.html">$tmp_start</a> = <a class="var it1388" onMouseOver="hilite(1388)" onMouseOut="lolite()" onClick="logVariable('offset')" href="../_variables/offset.html">$offset</a>;
<a name="l126"><span class="linenum"> 126</span></a>          }
<a name="l127"><span class="linenum"> 127</span></a>          <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('depth')" href="../_variables/depth.html">$depth</a> += <a class="var it4783" onMouseOver="hilite(4783)" onMouseOut="lolite()" onClick="logVariable('dincr')" href="../_variables/dincr.html">$dincr</a>;
<a name="l128"><span class="linenum"> 128</span></a>          if(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('depth')" href="../_variables/depth.html">$depth</a> == <a class="var it4768" onMouseOver="hilite(4768)" onMouseOut="lolite()" onClick="logVariable('rmdepth')" href="../_variables/rmdepth.html">$rmdepth</a> &amp;&amp; <a class="var it4783" onMouseOver="hilite(4783)" onMouseOut="lolite()" onClick="logVariable('dincr')" href="../_variables/dincr.html">$dincr</a> == -1)
<a name="l129"><span class="linenum"> 129</span></a>          {
<a name="l130"><span class="linenum"> 130</span></a>              <a class="var it4781" onMouseOver="hilite(4781)" onMouseOut="lolite()" onClick="logVariable('remove_regions')" href="../_variables/remove_regions.html">$remove_regions</a>[] = array(<a class="var it4782" onMouseOver="hilite(4782)" onMouseOut="lolite()" onClick="logVariable('tmp_start')" href="../_variables/tmp_start.html">$tmp_start</a>, <a class="var it1388" onMouseOver="hilite(1388)" onMouseOut="lolite()" onClick="logVariable('offset')" href="../_variables/offset.html">$offset</a>);
<a name="l131"><span class="linenum"> 131</span></a>          }
<a name="l132"><span class="linenum"> 132</span></a>      }
<a name="l133"><span class="linenum"> 133</span></a>      
<a name="l134"><span class="linenum"> 134</span></a>      if(<a class="function" onClick="logFunction('empty')" href="../_functions/empty.html" onMouseOver="funcPopup(event,'empty')">empty</a>(<a class="var it4781" onMouseOver="hilite(4781)" onMouseOut="lolite()" onClick="logVariable('remove_regions')" href="../_variables/remove_regions.html">$remove_regions</a>))
<a name="l135"><span class="linenum"> 135</span></a>      {
<a name="l136"><span class="linenum"> 136</span></a>          return <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>;
<a name="l137"><span class="linenum"> 137</span></a>      }
<a name="l138"><span class="linenum"> 138</span></a>      
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">    // finally, remove the quotes from the string</span>
<a name="l140"><span class="linenum"> 140</span></a>      <a class="var it4784" onMouseOver="hilite(4784)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../_variables/newtext.html">$newtext</a> = '';
<a name="l141"><span class="linenum"> 141</span></a>      <a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a> = 0;
<a name="l142"><span class="linenum"> 142</span></a>      foreach(<a class="var it4781" onMouseOver="hilite(4781)" onMouseOut="lolite()" onClick="logVariable('remove_regions')" href="../_variables/remove_regions.html">$remove_regions</a> as &amp;<a class="var it4786" onMouseOver="hilite(4786)" onMouseOut="lolite()" onClick="logVariable('region')" href="../_variables/region.html">$region</a>)
<a name="l143"><span class="linenum"> 143</span></a>      {
<a name="l144"><span class="linenum"> 144</span></a>          <a class="var it4784" onMouseOver="hilite(4784)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../_variables/newtext.html">$newtext</a> .= <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a>, <a class="var it4786" onMouseOver="hilite(4786)" onMouseOut="lolite()" onClick="logVariable('region')" href="../_variables/region.html">$region</a>[0]-<a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a>);
<a name="l145"><span class="linenum"> 145</span></a>          <a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a> = <a class="var it4786" onMouseOver="hilite(4786)" onMouseOut="lolite()" onClick="logVariable('region')" href="../_variables/region.html">$region</a>[1]+8; <span class="comment">// 8 = strlen('[/quote]')</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">        // clean up newlines</span>
<a name="l147"><span class="linenum"> 147</span></a>          <a class="var it4787" onMouseOver="hilite(4787)" onMouseOut="lolite()" onClick="logVariable('next_char')" href="../_variables/next_char.html">$next_char</a> = <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>{<a class="var it4786" onMouseOver="hilite(4786)" onMouseOut="lolite()" onClick="logVariable('region')" href="../_variables/region.html">$region</a>[1]+8};
<a name="l148"><span class="linenum"> 148</span></a>          if(<a class="var it4787" onMouseOver="hilite(4787)" onMouseOut="lolite()" onClick="logVariable('next_char')" href="../_variables/next_char.html">$next_char</a> == &quot;\r&quot; || <a class="var it4787" onMouseOver="hilite(4787)" onMouseOut="lolite()" onClick="logVariable('next_char')" href="../_variables/next_char.html">$next_char</a> == &quot;\n&quot;)
<a name="l149"><span class="linenum"> 149</span></a>          {
<a name="l150"><span class="linenum"> 150</span></a>              ++<a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a>;
<a name="l151"><span class="linenum"> 151</span></a>              if(<a class="var it4787" onMouseOver="hilite(4787)" onMouseOut="lolite()" onClick="logVariable('next_char')" href="../_variables/next_char.html">$next_char</a> == &quot;\r&quot; &amp;&amp; <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>{<a class="var it4786" onMouseOver="hilite(4786)" onMouseOut="lolite()" onClick="logVariable('region')" href="../_variables/region.html">$region</a>[1]+9} == &quot;\n&quot;)
<a name="l152"><span class="linenum"> 152</span></a>              {
<a name="l153"><span class="linenum"> 153</span></a>                  ++<a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a>;
<a name="l154"><span class="linenum"> 154</span></a>              }
<a name="l155"><span class="linenum"> 155</span></a>          }
<a name="l156"><span class="linenum"> 156</span></a>      }
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">    // append remaining end text</span>
<a name="l158"><span class="linenum"> 158</span></a>      if(strlen(<a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>) != <a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a>)
<a name="l159"><span class="linenum"> 159</span></a>      {
<a name="l160"><span class="linenum"> 160</span></a>          <a class="var it4784" onMouseOver="hilite(4784)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../_variables/newtext.html">$newtext</a> .= <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>, <a class="var it4785" onMouseOver="hilite(4785)" onMouseOut="lolite()" onClick="logVariable('cpy_start')" href="../_variables/cpy_start.html">$cpy_start</a>);
<a name="l161"><span class="linenum"> 161</span></a>      }
<a name="l162"><span class="linenum"> 162</span></a>      
<a name="l163"><span class="linenum"> 163</span></a>      
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">    // we're done</span>
<a name="l165"><span class="linenum"> 165</span></a>      return <a class="var it4784" onMouseOver="hilite(4784)" onMouseOut="lolite()" onClick="logVariable('newtext')" href="../_variables/newtext.html">$newtext</a>;
<a name="l166"><span class="linenum"> 166</span></a>  }
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>  
<a name="l169"><span class="linenum"> 169</span></a>  <span class="comment">/**</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment"> * Performs cleanup of a quoted message, such as replacing /me commands, before presenting quoted post to the user.</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment"> * </span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment"> * @param array quoted post info, taken from the DB (requires the 'message', 'username', 'pid' and 'dateline' entries to be set; will use 'userusername' if present)</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment"> * @param boolean whether to call remove_message_quotes() on the quoted message</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment"> * @return string the cleaned up message, wrapped in a quote tag</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment"> */</span>
<a name="l176"><span class="linenum"> 176</span></a>  
<a name="l177"><span class="linenum"> 177</span></a>  function <a class="function" onClick="logFunction('parse_quoted_message')" href="../_functions/parse_quoted_message.html" onMouseOver="funcPopup(event,'parse_quoted_message')">parse_quoted_message</a>(&amp;<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>, <a class="var it4788" onMouseOver="hilite(4788)" onMouseOut="lolite()" onClick="logVariable('remove_message_quotes')" href="../_variables/remove_message_quotes.html">$remove_message_quotes</a>=true)
<a name="l178"><span class="linenum"> 178</span></a>  {
<a name="l179"><span class="linenum"> 179</span></a>      global <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('parser')" href="../_variables/parser.html">$parser</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('lang')" href="../_variables/lang.html">$lang</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>;
<a name="l180"><span class="linenum"> 180</span></a>      if(!isset(<a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('parser')" href="../_variables/parser.html">$parser</a>))
<a name="l181"><span class="linenum"> 181</span></a>      {
<a name="l182"><span class="linenum"> 182</span></a>          <span class="keyword">require_once</span> <a class="filename" href="../inc/class_parser.php.html" onMouseOver="reqPopup(event, 'class_parser.php', '../inc/class_parser.php')"> MYBB_ROOT.&quot;inc/class_parser.php&quot;</a>;
<a name="l183"><span class="linenum"> 183</span></a>          <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('parser')" href="../_variables/parser.html">$parser</a> = <span class="keyword">new </span><a class="class" onClick="logClass('postParser')" href="../_classes/postparser.html" onMouseOver="classPopup(event,'postparser')">postParser</a>;
<a name="l184"><span class="linenum"> 184</span></a>      }
<a name="l185"><span class="linenum"> 185</span></a>      
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">    // Swap username over if we have a registered user</span>
<a name="l187"><span class="linenum"> 187</span></a>      if(<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['userusername'])
<a name="l188"><span class="linenum"> 188</span></a>      {
<a name="l189"><span class="linenum"> 189</span></a>          <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['username'] = <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['userusername'];
<a name="l190"><span class="linenum"> 190</span></a>      }
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment">    // Clean up the message</span>
<a name="l192"><span class="linenum"> 192</span></a>      <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['message'] = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(array(
<a name="l193"><span class="linenum"> 193</span></a>          '#(^|\r|\n)/me ([^\r\n&lt;]*)#i',
<a name="l194"><span class="linenum"> 194</span></a>          '#(^|\r|\n)/slap ([^\r\n&lt;]*)#i',
<a name="l195"><span class="linenum"> 195</span></a>          '#\[attachment=([0-9]+?)\]#i'
<a name="l196"><span class="linenum"> 196</span></a>      ), array(
<a name="l197"><span class="linenum"> 197</span></a>          &quot;\\1* {<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['username']} \\2&quot;,
<a name="l198"><span class="linenum"> 198</span></a>          &quot;\\1* {<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['username']} {<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('lang')" href="../_variables/lang.html">$lang</a>-&gt;<a onClick="logVariable('slaps')" class="var it8055" onMouseOver="hilite(8055)" onMouseOut="lolite()" href="../_variables/slaps.html">slaps</a>} \\2 {<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('lang')" href="../_variables/lang.html">$lang</a>-&gt;<a onClick="logVariable('with_trout')" class="var it8055" onMouseOver="hilite(8055)" onMouseOut="lolite()" href="../_variables/with_trout.html">with_trout</a>}&quot;,
<a name="l199"><span class="linenum"> 199</span></a>          &quot;&quot;,
<a name="l200"><span class="linenum"> 200</span></a>      ), <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['message']);
<a name="l201"><span class="linenum"> 201</span></a>      <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['message'] = <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('parser')" href="../_variables/parser.html">$parser</a>-&gt;<a class="function" onClick="logFunction('parse_badwords')" href="../_functions/parse_badwords.html" onMouseOver="funcPopup(event,'parse_badwords')">parse_badwords</a>(<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['message']);
<a name="l202"><span class="linenum"> 202</span></a>      
<a name="l203"><span class="linenum"> 203</span></a>      if(<a class="var it4788" onMouseOver="hilite(4788)" onMouseOut="lolite()" onClick="logVariable('remove_message_quotes')" href="../_variables/remove_message_quotes.html">$remove_message_quotes</a>)
<a name="l204"><span class="linenum"> 204</span></a>      {
<a name="l205"><span class="linenum"> 205</span></a>          global <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('mybb')" href="../_variables/mybb.html">$mybb</a>;
<a name="l206"><span class="linenum"> 206</span></a>          <a class="var it4789" onMouseOver="hilite(4789)" onMouseOut="lolite()" onClick="logVariable('max_quote_depth')" href="../_variables/max_quote_depth.html">$max_quote_depth</a> = <a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('mybb')" href="../_variables/mybb.html">$mybb</a>-&gt;<a onClick="logVariable('settings')" class="var it8056" onMouseOver="hilite(8056)" onMouseOut="lolite()" href="../_variables/settings.html">settings</a>['maxquotedepth']);
<a name="l207"><span class="linenum"> 207</span></a>          if(<a class="var it4789" onMouseOver="hilite(4789)" onMouseOut="lolite()" onClick="logVariable('max_quote_depth')" href="../_variables/max_quote_depth.html">$max_quote_depth</a>)
<a name="l208"><span class="linenum"> 208</span></a>          {
<a name="l209"><span class="linenum"> 209</span></a>              <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['message'] = <a class="function" onClick="logFunction('remove_message_quotes')" href="../_functions/remove_message_quotes.html" onMouseOver="funcPopup(event,'remove_message_quotes')">remove_message_quotes</a>(<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['message'], <a class="var it4789" onMouseOver="hilite(4789)" onMouseOut="lolite()" onClick="logVariable('max_quote_depth')" href="../_variables/max_quote_depth.html">$max_quote_depth</a>-1); <span class="comment">// we're wrapping the message in a [quote] tag, so take away one quote depth level</span>
<a name="l210"><span class="linenum"> 210</span></a>          }
<a name="l211"><span class="linenum"> 211</span></a>      }
<a name="l212"><span class="linenum"> 212</span></a>      
<a name="l213"><span class="linenum"> 213</span></a>      <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>-&gt;<a class="function" onClick="logFunction('run_hooks')" href="../_functions/run_hooks.html" onMouseOver="funcPopup(event,'run_hooks')">run_hooks</a>(&quot;parse_quoted_message&quot;, <a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>);
<a name="l214"><span class="linenum"> 214</span></a>      
<a name="l215"><span class="linenum"> 215</span></a>      return &quot;[quote='{<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['username']}' pid='{<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['pid']}' dateline='{<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['dateline']}']\n{<a class="var it1066" onMouseOver="hilite(1066)" onMouseOut="lolite()" onClick="logVariable('quoted_post')" href="../_variables/quoted_post.html">$quoted_post</a>['message']}\n[/quote]\n\n&quot;;
<a name="l216"><span class="linenum"> 216</span></a>  }
<a name="l217"><span class="linenum"> 217</span></a>  
<a name="l218"><span class="linenum"> 218</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'remove_message_quotes': ['remove_message_quotes', 'Selectively removes quote tags from a message, depending on its nested depth.  This is to be used with reply with quote functions. For malformed quote tag structures, will try to simulate how MyBB\'s parser handles the issue, but is slightly inaccurate. Examples, with a cutoff depth of 2: #1. INPUT:  [quote]a[quote=me]b[quote]c[/quote][/quote][/quote] OUTPUT:  [quote]a[quote=me]b[/quote][/quote] #2. INPUT:  [quote=a][quote=b][quote=c][quote=d][/quote][quote=e][/quote][/quote][quote=f][/quote][/quote] OUTPUT:  [quote=a][quote=b][/quote][quote=f][/quote][/quote] ', [['inc','functions_posting.php',12]], 3],
'run_hooks': ['run_hooks', 'Run the hooks that have plugins. ', [['inc','class_plugins.php',74]], 924],
'unset': ['unset', '', [['jscripts','prototype.js',1229]], 157],
'parse_badwords': ['parse_badwords', 'Parses a list of filtered/badwords in the specified message. ', [['inc','class_parser.php',501]], 64],
'parse_quoted_message': ['parse_quoted_message', 'Performs cleanup of a quoted message, such as replacing /me commands, before presenting quoted post to the user. ', [['inc','functions_posting.php',169]], 2],
'empty': ['empty', '', [['jscripts','prototype.js',715]], 368],
'intval': ['intval', '', [], 1305],
'substr': ['substr', '', [], 156],
'ksort': ['ksort', '', [], 16],
'reset': ['reset', '', [], 35],
'preg_replace': ['preg_replace', '', [], 153],
'preg_match_all': ['preg_match_all', '', [], 13]};
CLASS_DATA={
'postparser': ['postparser', '', [['inc','class_parser.php',25]], 37]};
CONST_DATA={
};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Mon Jun  4 13:54:24 2012</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
