<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>MyBB Documentation - Development:Plugin Hooks - Post Parser</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="author" content="MyBB Group" />
	<meta name="copyright" content="Copyright MyBB Group." />
	<meta name="description" content="The official documentation for MyBB, a free PHP and MySQL based discussion system." />
	<link rel="stylesheet" type="text/css" href="http://mybb.com/assets/screen.css?xmas" />
	<!--[if lt IE 8]>
	<link rel="stylesheet" type="text/css" href="http://mybb.com/assets/screen_ie.css?zz" />
	<![endif]-->

	<script type="text/javascript" src="http://mybb.com/jscripts/prototype.lite.js"></script>
	<script type="text/javascript" src="http://mybb.com/jscripts/general.js"></script>
	<script type="text/javascript" src="http://mybb.com/jscripts/moo.ajax.js"></script>
	<script type="text/javascript" src="http://mybb.com/jscripts/lightbox.js"></script>
	<!--[if lt IE 7]>
	<script defer type="text/javascript" src="http://mybb.com/assets/pngfix.js"></script>
	<![endif]-->
</head>
<body>
	<div id="shadow">
		<div id="container">
			<!--search:no_index-->
			<h1><span class="invisible">MyBB</span></h1>
			<div id="header">
			<a class="link" href="/"></a>
				<div id="search">
					<form action="/search" method="get"><fieldset><label for="search_box"><span id="search_left">&nbsp;</span></label><input type="text" name="query" id="search_box" title="Enter your search keywords" /><input type="submit" value="Search" name="submit-search" id="search_button" /></fieldset></form>
				</div>
				<div id="menu">
				<ul>
					<li class="default"><a href="/">Home</a></li>
					<li class="default"><a href="/about">About</a></li>
					<li class="default"><a href="/features">Features</a></li>
					<li class="default"><a href="/downloads">Downloads</a></li>
					<li class="default"><a href="http://community.mybb.com/">Community Forum</a></li>
					<li class="default"><a href="/get-involved">Get Involved</a></li>
					<li class="default"><a href="http://ideas.mybb.com/">Ideas</a></li>
					<li class="default"><a href="http://mods.mybb.com/">Mods</a></li>
					<li class="active"><a href="http://wiki.mybb.com/">Wiki</a></li>
					<li class="default"><a href="http://blog.mybb.com/">Blog</a></li>

				</ul>
				</div>
			</div>
			
			
			<!--/search:no_index-->
			<div id="content">
				<div id="sidebar">
					<div class="item">
					<div class="sidebar_top"><div class="right"></div></div>
						<h3>Categories</h3>
						<ul>
						
														
						</ul>
					<div class="sidebar_bottom"><div class="right"></div></div>
					</div>
				</div>
				
				<div id="page">
					<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Hooks"><span class="tocnumber">1</span> <span class="toctext">Hooks</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#parse_message_start"><span class="tocnumber">1.1</span> <span class="toctext">parse_message_start</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#parse_message"><span class="tocnumber">1.2</span> <span class="toctext">parse_message</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#parse_message_end"><span class="tocnumber">1.3</span> <span class="toctext">parse_message_end</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#text_parse_message"><span class="tocnumber">1.4</span> <span class="toctext">text_parse_message</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Examples"><span class="tocnumber">2</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#parse_message_start_2"><span class="tocnumber">2.1</span> <span class="toctext">parse_message_start</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#parse_message_2"><span class="tocnumber">2.2</span> <span class="toctext">parse_message</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Adding_.5Bb.5D_MyCode"><span class="tocnumber">2.2.1</span> <span class="toctext">Adding [b] MyCode</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#parse_message_end_2"><span class="tocnumber">2.3</span> <span class="toctext">parse_message_end</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#text_parse_message_2"><span class="tocnumber">2.4</span> <span class="toctext">text_parse_message</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>

<p>The post parser hooks allow you to modify a posts contents before it's output. It's most common uses include filtering words, MyCode and changing the posts contents.
</p>

<p>The parse_message_start hook is run before any processing of the message occurs. When the hook is run, it passes the message contents as the first parameter of the function, and the new message contents will be set to the return value. An array of parsing options can be accessed through the global $options, which is an array of the following:
</p>
<ul><li> allow_html
</li><li> allow_smilies
</li><li> allow_mycode
</li><li> nl2br
</li><li> filter_badwords
</li><li> me_username
</li><li> shorten_urls
</li><li> highlight
</li></ul>

<p>The parse_message hook is run after most of the parsing has been done, but before newlines have been parsed. When the hook is run, it passes the message contents as the first parameter of the function, and the new message contents will be set to the return value. It is useful to parse anything else after the rest of the parsing has occurred. As with parse_message_start, an array of parsing options can be accessed through the global $options.
</p>

<p>The parse_message_end hook is run right before the message has been returned. When the hook is run, it passes the message contents as the first parameter of the function, and the new message contents will be set to the return value. It can be used to modify the final message.
</p>

<p>Similar to parse_message_end, the text_parse_message hook is run right before the message has been returned, but in the text_parse_message function. The text_parse_message function turns the message into plaintext, removing any MyCode tags. An array of parsing options can be accessed through the global $options, which is an array of the following:
</p>
<ul><li> filter_badwords
</li><li> me_username
</li></ul>



<h3><span class="editsection">[<a href="http://localhost/mediawiki/index.php?title=Development:Plugin_Hooks_-_Post_Parser&amp;action=edit&amp;section=9" title="Edit section: Adding [b] MyCode">edit</a>]</span> <span class="mw-headline" id="Adding_.5Bb.5D_MyCode">Adding [b] MyCode</span></h3>
<p>Here is an example of how you would add a [b] (bold) MyCode using the parse_message hook:
</p>
<pre>
$plugins-&gt;add_hook(&quot;parse_message&quot;, &quot;bold_mycode_example&quot;);

function bold_mycode_example($message) {
global $options;

if($options['allow_mycode'])
{
$message = preg_replace('#\[b\](.*?)\[/b\]#i', &quot;&lt;strong&gt;$1&lt;/strong&gt;&quot;, $message);
}

return $message;
}
</pre>







					
					Last updated on: 2012-06-02 00:00:00 -0700.
				</div>
			</div>
		</div>
		
		<div id="footer">
				<script type="text/javascript" src="http://mybb.com/footer_credit.js"></script>
				<p>Copyright &copy; 2010 MyBB Group. All rights reserved.</p>
				<p><a href="/contact">Contact</a> MyBB Group &mdash; <em>for support with MyBB, visit <a href="/support">support</a></em></p><br />
			</div>
		</div>  
	</div>
	
	<div id="shadow_footer"></div>

	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-11443733-2']);
	  _gaq.push(['_setDomainName', 'none']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
</body>
</html>

